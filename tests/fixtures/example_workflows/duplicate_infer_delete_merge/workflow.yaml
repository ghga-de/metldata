operations:
  # Create the DatasetSummary class
  - name: duplicate_class
    description: "Add DatasetSummary class"
    args:
      source_class_name: Dataset
      target_class_name: DatasetSummary

  - name: infer_relation
    description: "Infer {{ relation_name }} for each DatasetSummary"
    args:
      class_name: DatasetSummary
      relation_name: "{{ relation_name }}"
      relation_path: "{{ relation_path }}"
    loop:
      - relation_name: samples_via_research_data_files
        relation_path: "DatasetSummary(research_data_files)>ResearchDataFile<(research_data_files)Sample"
      - relation_name: samples_via_processed_data_files
        relation_path: "DatasetSummary(processed_data_files)>ProcessedDataFile<(processed_data_files)Sample"
      - relation_name: experiments_via_research_data_files
        relation_path: "DatasetSummary(research_data_files)>ResearchDataFile<(research_data_files)Sample<(samples)Experiment"
      - relation_name: experiments_via_process_data_files
        relation_path: "DatasetSummary(processed_data_files)>ProcessedDataFile<(processed_data_files)Sample<(samples)Experiment"

  - name: merge_relations
    description: "Create {{ target_relation }} relation for each DatasetSummary"
    args:
      class_name: DatasetSummary
      source_relations: "{{ source_relations }}"
      target_relation: "{{ target_relation }}"
      description: "The {{ target_relation }} related to the dataset."
      mandatory:
        origin: false
        target: false
      multiple:
        origin: true
        target: true
    loop:
      - source_relations:
          [samples_via_research_data_files, samples_via_processed_data_files]
        target_relation: samples
      - source_relations:
          [
            experiments_via_research_data_files,
            experiments_via_process_data_files,
          ]
        target_relation: experiments
  - name: delete_class
    description: "Delete class {{ item }}"
    args:
      class_name: "{{ item }}"
    loop: # Delete all classes except DatasetSummary and Study (for embedding)
      - Dataset
      - ResearchDataFile
      - ProcessedDataFile
