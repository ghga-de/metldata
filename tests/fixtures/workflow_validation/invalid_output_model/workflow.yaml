operations:
  # Transform content schema and content to add current resource ids as alias so
  # the information isn't lost after the replace resource ids step
  - name: transform_content
    description: "Add alias to the content of {{ class_name }}"
    args:
      class_name: "{{{ item.class_name }}}"
      content_schema: "{{{ item.content_schema }}}"
      embedding_profile: "{{{ item.embedding_profile }}}"
      content_template_yaml: "{{{ item.content_template_yaml }}}"
    loop:
      - class_name: File
        content_schema:
          {
            "$schema": "http://json-schema.org/draft-07/schema#",
            "additionalProperties": false,
            "description": "A file is an object that contains information generated from a process, either an Experiment or an Analysis.",
            "properties":
              {
                "checksum": { "type": "string" },
                "filename": { "type": "string" },
                "format": { "type": "string" },
                "size": { "type": "integer" },
              },
            "required": ["filename", "format", "checksum", "size"],
            "type": "object",
          }
        embedding_profile: {}
        content_template_yaml: |
          {% for key in content_property_names %}
            {% set value = original.get(key) %}
            {% if value is not none %}
          {{ key }}: {{ value | tojson }}
            {% endif %}
          {% endfor %}
          not_alias: {{ original[id_property_name] }}
      - class_name: Dataset
        content_schema:
          {
            "$schema": "http://json-schema.org/draft-07/schema#",
            "additionalProperties": false,
            "description": "A dataset that is a collection of files.",
            "properties":
              {
                "dac_contact": { "type": "string" },
                "not_alias": { "type": "string" },
              },
            "required": ["not_alias"],
            "type": "object",
          }
        embedding_profile: { "files": False }
        content_template_yaml: |
          {% for key in content_property_names %}
            {% set value = original.get(key) %}
            {% if value is not none %}
          {{ key }}: {{ value | tojson }}
            {% endif %}
          {% endfor %}
          not_alias: {{ original[id_property_name] }}

      - class_name: Sample
        content_schema:
          {
            "$schema": "http://json-schema.org/draft-07/schema#",
            "additionalProperties": false,
            "description": "A sample used to generate files in the context of an experiment.",
            "properties":
              {
                "description": { "type": "string" },
                "not_alias": { "type": "string" },
              },
            "required": ["alias"],
            "type": "object",
          }
        embedding_profile: { "files": False }
        content_template_yaml: |
          {% for key in content_property_names %}
            {% set value = original.get(key) %}
            {% if value is not none %}
          {{ key }}: {{ value | tojson }}
            {% endif %}
          {% endfor %}
          not_alias: {{ original[id_property_name] }}
